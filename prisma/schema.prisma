datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model Team {
  id           Int            @id @default(autoincrement())
  name         String         @unique
  email        String         @unique
  password     String
  phone        String?
  image        String?
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt
  users        User[]
  categories   Category[]
  payments     Payment[]
  events       Event[]
}

model User {
  id           Int              @id @default(autoincrement())
  username     String           @unique
  password     String
  role         String           // 'MANAGER' ou 'ATHLETE'
  email        String?
  
  teamId       Int
  team         Team             @relation(fields: [teamId], references: [id])
  
  athlete      Athlete?
  payments     PaymentUser[]
  confirmations ConfirmationUser[]
}

model Athlete {
  id           Int               @id @default(autoincrement())
  firstName    String
  lastName     String
  phone        String?
  federationId String?
  birthDate    DateTime
  shirtNumber  String?
  
  userId       Int               @unique
  user         User              @relation(fields: [userId], references: [id])
  
  categories   CategoryAthlete[]
}

model Category {
  id         Int        @id @default(autoincrement())
  name       String
  
  teamId     Int
  team       Team       @relation(fields: [teamId], references: [id])

  athletes   CategoryAthlete[]
  payments   Payment[]
}

model CategoryAthlete {
  athleteId  Int
  athlete    Athlete    @relation(fields: [athleteId], references: [id])
  categoryId Int
  category   Category   @relation(fields: [categoryId], references: [id])

  @@id([athleteId, categoryId])
}

model Payment {
  id         Int        @id @default(autoincrement())
  name       String
  value      Float
  dueDate    DateTime
  pixKey     String
  
  teamId     Int
  team       Team       @relation(fields: [teamId], references: [id])

  category   Category   @relation(fields: [categoryId], references: [id])
  categoryId Int
  
  paidBy     PaymentUser[]
  items      PaymentItem[]
}

model PaymentItem {
  id          Int      @id @default(autoincrement())
  name        String
  value       Float
  quantityEnabled Boolean  @default(false)

  paymentId   Int
  payment     Payment  @relation(fields: [paymentId], references: [id])
}

model PaymentUser {
  paymentId Int
  payment   Payment  @relation(fields: [paymentId], references: [id])
  userId    Int
  user      User     @relation(fields: [userId], references: [id])
  paidAt    DateTime?

  @@id([paymentId, userId])
}

model Event {
  id          Int            @id @default(autoincrement())
  name        String
  description String?
  date        DateTime
  location    String?
  type        String         // 'TRAINING' ou 'CHAMPIONSHIP'
  
  teamId      Int
  team        Team           @relation(fields: [teamId], references: [id])

  confirmations Confirmation[]
}

model Confirmation {
  id          Int          @id @default(autoincrement())
  name        String
  
  eventId     Int
  event       Event        @relation(fields: [eventId], references: [id])
  
  confirmedBy ConfirmationUser[]
}

model ConfirmationUser {
  confirmationId Int
  confirmation   Confirmation @relation(fields: [confirmationId], references: [id])
  userId         Int
  user           User         @relation(fields: [userId], references: [id])
  confirmedAt    DateTime?
  
  confirmedItems  ConfirmationItem[]

  @@id([confirmationId, userId])
}

model ConfirmationItem {
  confirmationId        Int 
  userId                Int 

  confirmationUser      ConfirmationUser @relation(fields: [confirmationId, userId], references: [confirmationId, userId]) 
  
  paymentItemId         Int
  paymentItem           PaymentItem      @relation(fields: [paymentItemId], references: [id])

  quantity              Int              @default(1)

  @@id([confirmationId, userId, paymentItemId]) // A chave prim√°ria deve incluir todas as chaves estrangeiras
}